<html>
<head>
  <title>30.- What are secondary indexes ?</title>
  <basefont face="Tahoma" size="2" />
  <meta http-equiv="Content-Type" content="text/html;charset=utf-8" />
  <meta name="exporter-version" content="Evernote Windows/301769 (en-US); Windows/10.0.14342 (Win64);"/>
  <style>
    body, td {
      font-family: Tahoma;
      font-size: 10pt;
    }
  </style>
</head>
<body>
<a name="1087"/>
<h1>30.- What are secondary indexes ?</h1>

<div>
<span><div>30.- What are secondary indexes ?</div><div><br/></div><div><b style="font-weight: bold; margin-top: 0px; color: rgb(51, 51, 51); font-family: Georgia, Times, &apos;Times New Roman&apos;, serif; font-size: 15px; font-style: normal; font-variant: normal; letter-spacing: normal; orphans: auto; text-align: start; text-indent: 0px; text-transform: none; white-space: normal; widows: 1; word-spacing: 0px; -webkit-text-stroke-width: 0px;">Primary index</b><br style="color: rgb(51, 51, 51); font-family: Georgia, Times, &apos;Times New Roman&apos;, serif; font-size: 15px; font-style: normal; font-variant: normal; font-weight: normal; letter-spacing: normal; orphans: auto; text-align: start; text-indent: 0px; text-transform: none; white-space: normal; widows: 1; word-spacing: 0px; -webkit-text-stroke-width: 0px;"/><ul style="margin: 0px 2em 1em 0px; padding: 0px; list-style: disc; color: rgb(51, 51, 51); font-family: Georgia, Times, &apos;Times New Roman&apos;, serif; font-size: 15px; font-style: normal; font-variant: normal; font-weight: normal; letter-spacing: normal; orphans: auto; text-align: start; text-indent: 0px; text-transform: none; white-space: normal; widows: 1; word-spacing: 0px; -webkit-text-stroke-width: 0px;"><li style="margin: 0px; padding: 0px 0px 0.7em; position: relative; left: 2em;">A primary index is an index on a set of fields that includes the unique primary key for the field and is guaranteed not to contain duplicates.</li><li style="margin: 0px; padding: 0px 0px 0.7em; position: relative; left: 2em;">Also Called a **Clustered index**.</li><li style="margin: 0px; padding: 0px 0px 0.7em; position: relative; left: 2em;">eg. Employee ID can be Example of it.</li></ul><b style="font-weight: bold; color: rgb(51, 51, 51); font-family: Georgia, Times, &apos;Times New Roman&apos;, serif; font-size: 15px; font-style: normal; font-variant: normal; letter-spacing: normal; orphans: auto; text-align: start; text-indent: 0px; text-transform: none; white-space: normal; widows: 1; word-spacing: 0px; -webkit-text-stroke-width: 0px;">Secondary index</b><br style="color: rgb(51, 51, 51); font-family: Georgia, Times, &apos;Times New Roman&apos;, serif; font-size: 15px; font-style: normal; font-variant: normal; font-weight: normal; letter-spacing: normal; orphans: auto; text-align: start; text-indent: 0px; text-transform: none; white-space: normal; widows: 1; word-spacing: 0px; -webkit-text-stroke-width: 0px;"/><ul style="margin: 0px 2em 1em 0px; padding: 0px; list-style: disc; font-family: Georgia, Times, &apos;Times New Roman&apos;, serif; font-style: normal; font-variant: normal; font-weight: normal; letter-spacing: normal; text-align: start; text-indent: 0px; text-transform: none; white-space: normal; widows: 1; word-spacing: 0px; -webkit-text-stroke-width: 0px;"><li style="margin: 0px; padding: 0px 0px 0.7em; position: relative; left: 2em;"><span style="color: rgb(51, 51, 51);"><span style="font-size: 15px;">A Secondary index is an index that is not a primary index and may have duplicates.</span></span></li><li style="margin: 0px; padding: 0px 0px 0.7em; position: relative; left: 2em;"><span style="font-size: 15px;"><span style="color: rgb(51, 51, 51);"><span style="font-size: 15px;">eg. Employee name can be example of it. Because Employee name can have similar values.</span></span></span></li></ul><div style="margin: 0px; padding: 0px 0px 0.7em; position: relative; left: 2em;"><div><span style="color: rgb(51, 51, 51);"><br/></span></div><div><br/></div><div style="padding: 0px 0px 14px; font-style: normal; font-variant: normal; letter-spacing: normal; text-align: start; text-indent: 0px; text-transform: none; white-space: normal; widows: 1; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(255, 255, 255);"><div><span style="color: rgb(228, 121, 17);"><span style="font-size: 24px;"><span style="font-family: &apos;Open Sans&apos;, &apos;Lucida Grande&apos;, &apos;Helvetica Neue&apos;, Arial;"><b>Global Secondary Indexes</b></span></span></span></div><div><span style="color: rgb(228, 121, 17);"><span style="font-size: 24px;"><span style="font-family: &apos;Open Sans&apos;, &apos;Lucida Grande&apos;, &apos;Helvetica Neue&apos;, Arial;"><b><br/></b></span></span></span></div><div><span style="color: rgb(68, 68, 68); font-family: &apos;Open Sans&apos;, &apos;Lucida Grande&apos;, &apos;Helvetica Neue&apos;, Arial; font-size: 16px; font-style: normal; font-variant: normal; font-weight: normal; letter-spacing: normal; orphans: auto; text-align: start; text-indent: 0px; text-transform: none; white-space: normal; widows: 1; word-spacing: 0px; -webkit-text-stroke-width: 0px; display: inline !important; float: none; background-color: rgb(255, 255, 255);">Some applications might need to perform many kinds of queries, using a variety of different attributes as query criteria. To support these requirements, you can create one or more global secondary indexes and issue </span><code style="font-family: &apos;Courier New&apos;, Courier, mono; overflow: auto; color: rgb(68, 68, 68); font-size: 16px; font-style: normal; font-variant: normal; font-weight: normal; letter-spacing: normal; orphans: auto; text-align: start; text-indent: 0px; text-transform: none; white-space: normal; widows: 1; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(255, 255, 255);">Query</code><span style="color: rgb(68, 68, 68); font-family: &apos;Open Sans&apos;, &apos;Lucida Grande&apos;, &apos;Helvetica Neue&apos;, Arial; font-size: 16px; font-style: normal; font-variant: normal; font-weight: normal; letter-spacing: normal; orphans: auto; text-align: start; text-indent: 0px; text-transform: none; white-space: normal; widows: 1; word-spacing: 0px; -webkit-text-stroke-width: 0px; display: inline !important; float: none; background-color: rgb(255, 255, 255);"> requests against these indexes.</span></div><div><span style="font-size: 16px;"><span style="font-family: &apos;Open Sans&apos;, &apos;Lucida Grande&apos;, &apos;Helvetica Neue&apos;, Arial;"><span style="background-color: rgb(255, 255, 255);"><span style="color: rgb(68, 68, 68);"><br/></span></span></span></span></div><div><br/></div><div style="padding: 0px 0px 14px; font-style: normal; font-variant: normal; letter-spacing: normal; text-align: start; text-indent: 0px; text-transform: none; white-space: normal; widows: 1; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(255, 255, 255);"><div><span style="color: rgb(228, 121, 17);"><span style="font-size: 24px;"><span style="font-family: &apos;Open Sans&apos;, &apos;Lucida Grande&apos;, &apos;Helvetica Neue&apos;, Arial;"><b>Local Secondary Indexes</b></span></span></span></div><div><span style="color: rgb(228, 121, 17);"><span style="font-size: 24px;"><span style="font-family: &apos;Open Sans&apos;, &apos;Lucida Grande&apos;, &apos;Helvetica Neue&apos;, Arial;"><b><br/></b></span></span></span></div><div><span style="color: rgb(68, 68, 68); font-family: &apos;Open Sans&apos;, &apos;Lucida Grande&apos;, &apos;Helvetica Neue&apos;, Arial; font-size: 16px; font-style: normal; font-variant: normal; font-weight: normal; letter-spacing: normal; orphans: auto; text-align: start; text-indent: 0px; text-transform: none; white-space: normal; widows: 1; word-spacing: 0px; -webkit-text-stroke-width: 0px; display: inline !important; float: none; background-color: rgb(255, 255, 255);">Some applications only need to query data using the table's primary key; however, there may be situations where an alternate sort key would be helpful. To give your application a choice of sort keys, you can create one or more local secondary indexes on a table and issue </span><code style="font-family: &apos;Courier New&apos;, Courier, mono; overflow: auto; color: rgb(68, 68, 68); font-size: 16px; font-style: normal; font-variant: normal; font-weight: normal; letter-spacing: normal; orphans: auto; text-align: start; text-indent: 0px; text-transform: none; white-space: normal; widows: 1; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(255, 255, 255);">Query</code><span style="color: rgb(68, 68, 68); font-family: &apos;Open Sans&apos;, &apos;Lucida Grande&apos;, &apos;Helvetica Neue&apos;, Arial; font-size: 16px; font-style: normal; font-variant: normal; font-weight: normal; letter-spacing: normal; orphans: auto; text-align: start; text-indent: 0px; text-transform: none; white-space: normal; widows: 1; word-spacing: 0px; -webkit-text-stroke-width: 0px; display: inline !important; float: none; background-color: rgb(255, 255, 255);"> or </span><code style="font-family: &apos;Courier New&apos;, Courier, mono; overflow: auto; color: rgb(68, 68, 68); font-size: 16px; font-style: normal; font-variant: normal; font-weight: normal; letter-spacing: normal; orphans: auto; text-align: start; text-indent: 0px; text-transform: none; white-space: normal; widows: 1; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(255, 255, 255);">Scan</code><span style="color: rgb(68, 68, 68); font-family: &apos;Open Sans&apos;, &apos;Lucida Grande&apos;, &apos;Helvetica Neue&apos;, Arial; font-size: 16px; font-style: normal; font-variant: normal; font-weight: normal; letter-spacing: normal; orphans: auto; text-align: start; text-indent: 0px; text-transform: none; white-space: normal; widows: 1; word-spacing: 0px; -webkit-text-stroke-width: 0px; display: inline !important; float: none; background-color: rgb(255, 255, 255);"> requests against these indexes.</span></div><div><span style="font-size: 16px;"><span style="font-family: &apos;Open Sans&apos;, &apos;Lucida Grande&apos;, &apos;Helvetica Neue&apos;, Arial;"><span style="background-color: rgb(255, 255, 255);"><span style="color: rgb(68, 68, 68);">------------------------------------------------------</span></span></span></span></div><div><span style="font-size: 16px;"><span style="font-family: &apos;Open Sans&apos;, &apos;Lucida Grande&apos;, &apos;Helvetica Neue&apos;, Arial;"><span style="background-color: rgb(255, 255, 255);"><span style="color: rgb(68, 68, 68);"><br/></span></span></span></span></div><div><img src="30.- What are secondary indexes_files/Image.png" type="image/png" style="height:auto;" width="780"/></div><div><span style="font-family: Arial, Helvetica, sans-serif;"><br/></span></div><div><span style="font-family: Georgia, Times, &apos;Times New Roman&apos;, serif;"><span style="font-size: 15px;"><span style="font-family: Arial, Helvetica, sans-serif;">Secondary index  is a way to efficiently access records in a database (the primary) by means of some piece of information other than the usual (primary) key.</span></span></span></div><div><span style="font-family: Georgia, Times, &apos;Times New Roman&apos;, serif;"><span style="font-size: 15px;"><span style="font-family: Arial, Helvetica, sans-serif;">Example can be if an index is simply another database whose keys are these pieces of information (the secondary keys), and whose data are the primary keys.</span></span></span></div></div></div></div><div style="margin: 0px; padding: 0px 0px 0.7em; position: relative; left: 2em;"><div><span style="font-family: Georgia, Times, &apos;Times New Roman&apos;, serif;"><span style="font-size: 15px;"><span style="font-family: Arial, Helvetica, sans-serif;">Secondary indexes can be created manually by the application; there is no disadvantage, other than complexity, to doing so. However, when the secondary key can be mechanically</span></span></span></div><div><span style="font-family: Georgia, Times, &apos;Times New Roman&apos;, serif;"><span style="font-size: 15px;"><span style="font-family: Arial, Helvetica, sans-serif;">derived from the primary key and data that it points to, as is frequently the case, DBs can automatically and transparently manage secondary indexes.</span></span></span></div></div><div style="margin: 0px; padding: 0px 0px 0.7em; position: relative; left: 2em;"><div><br/></div><div style="font-style: normal; font-variant: normal; font-weight: normal; letter-spacing: normal; text-align: start; text-indent: 0px; text-transform: none; white-space: normal; widows: 1; word-spacing: 0px; -webkit-text-stroke-width: 0px;"><div><span style="font-family: Arial, Helvetica, sans-serif;"><span style="font-size: 15px;">As an example of how secondary indexes might be used, consider a database containing a list of students at a college, each of whom has a unique student ID number.</span></span></div><div><span style="font-family: Arial, Helvetica, sans-serif;"><span style="font-size: 15px;">A typical database would use the student ID number as the key; however, one might also reasonably want to be able to look up students by last name.</span></span></div><div><span style="font-family: Arial, Helvetica, sans-serif;"><span style="font-size: 15px;">To do this, one would construct a secondary index in which the secondary key was this last name.</span></span></div><div><span style="font-size: 14.6667px;"><span style="font-family: monospace;"><br/></span></span></div><div><p style="color: rgb(0, 0, 0); font-family: Arial, Helvetica, sans-serif; font-size: 14.6667px; font-style: normal; font-variant: normal; font-weight: normal; letter-spacing: normal; orphans: auto; text-align: start; text-indent: 0px; text-transform: none; white-space: normal; widows: 1; word-spacing: 0px; -webkit-text-stroke-width: 0px;">In SQL, this would be done by executing something like the following:</p><div style="font-family: monospace; color: rgb(0, 0, 0); font-size: 14.6667px; font-style: normal; font-variant: normal; font-weight: normal; letter-spacing: normal; orphans: auto; text-align: start; text-indent: 0px; text-transform: none; widows: 1; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(234, 232, 233);">CREATE TABLE students(student_id CHAR(4) NOT NULL,<br/>
        lastname CHAR(15), firstname CHAR(15), PRIMARY KEY(student_id));<br/>
CREATE INDEX lname ON students(lastname);<br/></div></div><div><span style="font-size: 14.6667px;"><span style="font-family: monospace;"><br/></span></span></div><div><span style="color: rgb(0, 0, 0); font-family: Arial, Helvetica, sans-serif; font-size: 14.6667px; font-style: normal; font-variant: normal; font-weight: normal; letter-spacing: normal; orphans: auto; text-align: start; text-indent: 0px; text-transform: none; white-space: normal; widows: 1; word-spacing: 0px; -webkit-text-stroke-width: 0px; display: inline !important; float: none;">In Berkeley DB, this would work as follows</span></div><div><span style="font-size: 14.6667px;"><span style="font-family: Arial, Helvetica, sans-serif;"><br/></span></span></div><div style="font-family: monospace; color: rgb(0, 0, 0); font-size: 14.6667px; font-style: normal; font-variant: normal; font-weight: normal; letter-spacing: normal; orphans: auto; text-align: start; text-indent: 0px; text-transform: none; widows: 1; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(234, 232, 233);">struct student_record {<br/>
        char student_id[4];<br/>
        char last_name[15];<br/>
        char first_name[15];<br/>
};<br/><br/>
void<br/>
second()<br/>
{<br/>
        DB *dbp, *sdbp;<br/>
        int ret;<br/>
       <br/>
        /* Open/create primary */<br/>
        if ((ret = db_create(&amp;dbp, dbenv, 0)) != 0)<br/>
                handle_error(ret);<br/>
        if ((ret = dbp-&gt;open(dbp, NULL,<br/>
            &quot;students.db&quot;, NULL, DB_BTREE, DB_CREATE, 0600)) != 0)<br/>
                handle_error(ret);<br/>
       <br/>
        /*<br/>
         * Open/create secondary.  Note that it supports duplicate data<br/>
         * items, since last names might not be unique.<br/>
         */<br/>
        if ((ret = db_create(&amp;sdbp, dbenv, 0)) != 0)<br/>
                handle_error(ret);<br/>
        if ((ret = sdbp-&gt;set_flags(sdbp, DB_DUP | DB_DUPSORT)) != 0)<br/>
                handle_error(ret);<br/>
        if ((ret = sdbp-&gt;open(sdbp, NULL,<br/>
            &quot;lastname.db&quot;, NULL, DB_BTREE, DB_CREATE, 0600)) != 0)<br/>
                handle_error(ret);<br/>
       <br/>
        /* Associate the secondary with the primary. */<br/>
        if ((ret = dbp-&gt;associate(dbp, NULL, sdbp, getname, 0)) != 0)<br/>
                handle_error(ret);<br/>
}<br/><br/>
/*<br/>
 * getname -- extracts a secondary key (the last name) from a primary<br/>
 *      key/data pair<br/>
 */<br/>
int<br/>
getname(secondary, pkey, pdata, skey)<br/>
        DB *secondary;<br/>
        const DBT *pkey, *pdata;<br/>
        DBT *skey;<br/>
{<br/>
        /*<br/>
         * Since the secondary key is a simple structure member of the<br/>
         * record, we don't have to do anything fancy to return it.  If<br/>
         * we have composite keys that need to be constructed from the<br/>
         * record, rather than simply pointing into it, then the user's<br/>
         * function might need to allocate space and copy data.  In<br/>
         * this case, the DB_DBT_APPMALLOC flag should be set in the<br/>
         * secondary key DBT.<br/>
         */<br/>
        memset(skey, 0, sizeof(DBT));<br/>
        skey-&gt;data = ((struct student_record *)pdata-&gt;data)-&gt;last_name;<br/>
        skey-&gt;size = sizeof((struct student_record *)pdata-&gt;data)-&gt;last_name;<br/>
        return (0);<br/>
}<br/></div><div><span style="font-size: 14.6667px;"><span style="font-family: monospace;"><br/></span></span></div><div><span style="font-size: 14.6667px;"><span style="font-family: monospace;"><br/></span></span></div><div><span style="font-size: 14.6667px;"><span style="font-family: monospace;"><br/></span></span></div><div><span style="font-size: 14.6667px;"><span style="font-family: monospace;"><br/></span></span></div></div></div></div></span>
</div></body></html> 