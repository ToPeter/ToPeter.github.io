<html>
<head>
  <title>31.- Explain the query execution</title>
  <basefont face="Tahoma" size="2" />
  <meta http-equiv="Content-Type" content="text/html;charset=utf-8" />
  <meta name="exporter-version" content="Evernote Windows/301769 (en-US); Windows/10.0.14342 (Win64);"/>
  <style>
    body, td {
      font-family: Tahoma;
      font-size: 10pt;
    }
  </style>
</head>
<body>
<a name="1093"/>
<h1>31.- Explain the query execution</h1>

<div>
<span><div>31.- Explain the query execution</div><div><br/></div><div><p style="margin: 0.5em 0px; color: rgb(37, 37, 37); font-family: sans-serif; font-size: 14px; font-style: normal; font-variant: normal; font-weight: normal; letter-spacing: normal; orphans: auto; text-align: start; text-indent: 0px; text-transform: none; white-space: normal; widows: 1; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(255, 255, 255);">A <b>query plan</b> (or <b>query execution plan</b>) is an ordered set of steps used to <a href="https://en.wikipedia.org/wiki/Data_access" style="text-decoration: none; color: rgb(11, 0, 128); background: none;" title="Data access">access data</a> in a <a href="https://en.wikipedia.org/wiki/SQL" style="text-decoration: none; color: rgb(11, 0, 128); background: none;" title="SQL">SQL</a> <a href="https://en.wikipedia.org/wiki/Relational_database_management_system" style="text-decoration: none; color: rgb(11, 0, 128); background: none;" title="Relational database management system">relational database management system</a>. This is a specific case of the <a href="https://en.wikipedia.org/wiki/Relational_model" style="text-decoration: none; color: rgb(11, 0, 128); background: none;" title="Relational model">relational model</a> concept of access plans.</p><div style="margin: 0.5em 0px; font-style: normal; font-variant: normal; font-weight: normal; letter-spacing: normal; text-align: start; text-indent: 0px; text-transform: none; white-space: normal; widows: 1; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(255, 255, 255);"><div><span style="color: rgb(37, 37, 37);"><span style="font-family: sans-serif;"><span style="font-size: 15px;">Since <a href="https://en.wikipedia.org/wiki/SQL" style="text-decoration: none; color: rgb(11, 0, 128); background: none;" title="SQL"><span style="font-size: 15px;">SQL</span></a> is <a href="https://en.wikipedia.org/wiki/Declarative_programming" style="text-decoration: none; color: rgb(11, 0, 128); background: none;" title="Declarative programming"><span style="font-size: 15px;">declarative</span></a>, there are typically a large number of alternative ways to execute a given query, with widely varying performance. When a <a href="https://en.wikipedia.org/wiki/Information_retrieval" style="text-decoration: none; color: rgb(11, 0, 128); background: none;" title="Information retrieval"><span style="font-size: 15px;">query</span></a> is submitted to the database, the <a href="https://en.wikipedia.org/wiki/Query_optimizer" style="text-decoration: none; color: rgb(11, 0, 128); background: none;" title="Query optimizer"><span style="font-size: 15px;">query optimizer</span></a>evaluates some of the different, correct possible plans for executing the query and returns what it considers the best option. Because query optimizers are imperfect, database users and administrators sometimes need to manually examine and tune the plans produced by the optimizer to get better performance.</span></span></span></div><div><br/></div><div><div style="color: rgb(0, 0, 0); font-weight: normal; margin: 1em 0px 0.25em; overflow: hidden; padding: 0px; border-bottom-width: 1px; border-bottom-style: solid; border-bottom-color: rgb(170, 170, 170); font-family: &apos;Linux Libertine&apos;, Georgia, Times, serif; font-style: normal; font-variant: normal; letter-spacing: normal; text-align: start; text-indent: 0px; text-transform: none; white-space: normal; widows: 1; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-image: none; background-color: rgb(255, 255, 255); font-size: 20px; background-position: initial initial; background-repeat: initial initial;"><div>Generating query plans</div></div><p style="margin: 0.5em 0px; color: rgb(37, 37, 37); font-family: sans-serif; font-size: 14px; font-style: normal; font-variant: normal; font-weight: normal; letter-spacing: normal; orphans: auto; text-align: start; text-indent: 0px; text-transform: none; white-space: normal; widows: 1; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(255, 255, 255);">A given database management system may offer one or more mechanisms for returning the plan for a given query. Some packages feature tools which will generate a graphical representation of a query plan. Other tools allow a special mode to be set on the connection to cause the DBMS to return a textual description of the query plan. Another mechanism for retrieving the query plan involves querying a virtual database table after executing the query to be examined. In Oracle, for instance, this can be achieved using the EXPLAIN PLAN statement.</p><h3 style="color: rgb(0, 0, 0); font-weight: bold; margin: 0.3em 0px 0px; overflow: hidden; padding-top: 0.5em; padding-bottom: 0px; border-bottom-style: none; font-size: 1.2em; font-family: sans-serif; font-style: normal; font-variant: normal; letter-spacing: normal; orphans: auto; text-align: start; text-indent: 0px; text-transform: none; white-space: normal; widows: 1; word-spacing: 0px; -webkit-text-stroke-width: 0px; background: none rgb(255, 255, 255);">Graphical plans<span style="font-size: small; font-weight: normal; margin-left: 1em; vertical-align: baseline; display: inline-block; white-space: nowrap; unicode-bidi: isolate; font-family: sans-serif;"><span style="margin-right: 0.25em; color: rgb(85, 85, 85);">[</span><a href="https://en.wikipedia.org/w/index.php?title=Query_plan&amp;action=edit&amp;section=2" style="text-decoration: none; color: rgb(11, 0, 128); background: none;" title="Edit section: Graphical plans">edit</a><span style="margin-left: 0.25em; color: rgb(85, 85, 85);">]</span></span></h3><table style="font-size: 14px; color: rgb(37, 37, 37); font-family: sans-serif; font-style: normal; font-variant: normal; font-weight: normal; letter-spacing: normal; orphans: auto; text-align: start; text-indent: 0px; text-transform: none; white-space: normal; widows: 1; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(255, 255, 255);width:1422px;"><tbody><tr><td style="width:99.78902953586498%;"><p style="margin: 0.5em 0px;">The SQL Server Management Studio tool which ships with <a href="https://en.wikipedia.org/wiki/Microsoft_SQL_Server" style="text-decoration: none; color: rgb(11, 0, 128); background: none;" title="Microsoft SQL Server">Microsoft SQL Server</a>, for example, shows this graphical plan when executing this two-table join against a sample database:</p><div dir="ltr" style="direction: ltr; unicode-bidi: embed; background: rgb(248, 248, 248);"><pre style="font-family: monospace, Courier; color: rgb(0, 0, 0); border: 1px solid rgb(221, 221, 221); padding: 1em; white-space: pre-wrap; tab-size: 4; background-color: rgb(249, 249, 249);"><span style="color: rgb(0, 128, 0); font-weight: bold;">SELECT</span> <span style="color: rgb(102, 102, 102);">*</span><span style="color: rgb(0, 128, 0); font-weight: bold;">FROM</span> HumanResources.Employee <span style="color: rgb(0, 128, 0); font-weight: bold;">AS</span> e
    <span style="color: rgb(0, 128, 0); font-weight: bold;">INNER</span> <span style="color: rgb(0, 128, 0); font-weight: bold;">JOIN</span> Person.Contact <span style="color: rgb(0, 128, 0); font-weight: bold;">AS</span> <span style="color: rgb(0, 128, 0); font-weight: bold;">c</span>
    <span style="color: rgb(0, 128, 0); font-weight: bold;">ON</span> e.ContactID <span style="color: rgb(102, 102, 102);">=</span> <span style="color: rgb(0, 128, 0); font-weight: bold;">c</span>.ContactID<span style="color: rgb(0, 128, 0); font-weight: bold;">ORDER</span> <span style="color: rgb(0, 128, 0); font-weight: bold;">BY</span> <span style="color: rgb(0, 128, 0); font-weight: bold;">c</span>.LastName
</pre></div><p style="margin: 0.5em 0px;">The UI allows exploration of various attributes of the operators involved in the query plan, including the operator type, the number of rows each operator consumes or produces, and the expected cost of each operator's work.</p></td></tr></tbody></table></div><div><img src="31.- Explain the query execution_files/Image.png" type="image/png" style="height:auto;" width="620"/></div><div><br/></div><div><div style="color: rgb(0, 0, 0); font-weight: normal; margin: 1em 0px 0.25em; overflow: hidden; padding: 0px; border-bottom-width: 1px; border-bottom-style: solid; border-bottom-color: rgb(170, 170, 170); font-family: &apos;Linux Libertine&apos;, Georgia, Times, serif; font-style: normal; font-variant: normal; letter-spacing: normal; text-align: start; text-indent: 0px; text-transform: none; white-space: normal; widows: 1; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-image: none; background-color: rgb(255, 255, 255); font-size: 20px; background-position: initial initial; background-repeat: initial initial;"><div>Database tuning</div></div><div style="font-style: italic; padding-left: 1.6em; margin-bottom: 0.5em; color: rgb(37, 37, 37); font-family: sans-serif; font-size: 14px; font-variant: normal; font-weight: normal; letter-spacing: normal; orphans: auto; text-align: start; text-indent: 0px; text-transform: none; white-space: normal; widows: 1; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(255, 255, 255);">Main article: <a href="https://en.wikipedia.org/wiki/Database_tuning" style="text-decoration: none; color: rgb(11, 0, 128); background: none;" title="Database tuning">Database tuning</a></div><p style="margin: 0.5em 0px; color: rgb(37, 37, 37); font-family: sans-serif; font-size: 14px; font-style: normal; font-variant: normal; font-weight: normal; letter-spacing: normal; orphans: auto; text-align: start; text-indent: 0px; text-transform: none; white-space: normal; widows: 1; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(255, 255, 255);">Reviewing the query plan can present opportunities for new <a href="https://en.wikipedia.org/wiki/Index_(database)" style="text-decoration: none; color: rgb(11, 0, 128); background: none;" title="Index (database)">indexes</a> or changes to existing indexes. It can also show that the database is not properly taking advantage of existing indexes (see <a href="https://en.wikipedia.org/wiki/Query_optimizer" style="text-decoration: none; color: rgb(11, 0, 128); background: none;" title="Query optimizer">query optimizer</a>).</p></div><div><br/></div><div><div style="color: rgb(0, 0, 0); font-weight: normal; margin: 1em 0px 0.25em; overflow: hidden; padding: 0px; border-bottom-width: 1px; border-bottom-style: solid; border-bottom-color: rgb(170, 170, 170); font-family: &apos;Linux Libertine&apos;, Georgia, Times, serif; font-style: normal; font-variant: normal; letter-spacing: normal; text-align: start; text-indent: 0px; text-transform: none; white-space: normal; widows: 1; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-image: none; background-color: rgb(255, 255, 255); font-size: 20px; background-position: initial initial; background-repeat: initial initial;"><div>Query tuning</div></div><div style="font-style: italic; padding-left: 1.6em; margin-bottom: 0.5em; color: rgb(37, 37, 37); font-family: sans-serif; font-size: 14px; font-variant: normal; font-weight: normal; letter-spacing: normal; orphans: auto; text-align: start; text-indent: 0px; text-transform: none; white-space: normal; widows: 1; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(255, 255, 255);">Main article: <a href="https://en.wikipedia.org/wiki/Query_optimizer" style="text-decoration: none; color: rgb(11, 0, 128); background: none;" title="Query optimizer">Query optimizer</a></div><p style="margin: 0.5em 0px; color: rgb(37, 37, 37); font-family: sans-serif; font-size: 14px; font-style: normal; font-variant: normal; font-weight: normal; letter-spacing: normal; orphans: auto; text-align: start; text-indent: 0px; text-transform: none; white-space: normal; widows: 1; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(255, 255, 255);">A query optimizer will not always choose the most efficient query plan for a given query. In some databases the query plan can be reviewed, problems found, and then the <a href="https://en.wikipedia.org/wiki/Query_optimizer" style="text-decoration: none; color: rgb(11, 0, 128); background: none;" title="Query optimizer">query optimizer</a> gives <a href="https://en.wikipedia.org/wiki/Hint_(SQL)" style="text-decoration: none; color: rgb(11, 0, 128); background: none;" title="Hint (SQL)">hints</a> on how to improve it. In other databases alternatives to express the same query (other queries that return the same results) can be tried. Some query tools can generate embedded hints in the query, for use by the optimizer.</p><p style="margin: 0.5em 0px; color: rgb(37, 37, 37); font-family: sans-serif; font-size: 14px; font-style: normal; font-variant: normal; font-weight: normal; letter-spacing: normal; orphans: auto; text-align: start; text-indent: 0px; text-transform: none; white-space: normal; widows: 1; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(255, 255, 255);">Some databases - like Oracle - provide a <b>plan table</b> for query tuning. This plan table will return the cost and time for executing a query. Oracle offers two optimization approaches:</p><ol style="margin: 0.3em 0px 0px 3.2em; padding: 0px; list-style-image: none; color: rgb(37, 37, 37); font-family: sans-serif; font-size: 14px; font-style: normal; font-variant: normal; font-weight: normal; letter-spacing: normal; orphans: auto; text-align: start; text-indent: 0px; text-transform: none; white-space: normal; widows: 1; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(255, 255, 255);"><li style="margin-bottom: 0.1em;">CBO or Cost Based Optimization</li><li style="margin-bottom: 0.1em;">RBO or Rule Based Optimization</li></ol><p style="margin: 0.5em 0px; color: rgb(37, 37, 37); font-family: sans-serif; font-size: 14px; font-style: normal; font-variant: normal; font-weight: normal; letter-spacing: normal; orphans: auto; text-align: start; text-indent: 0px; text-transform: none; white-space: normal; widows: 1; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(255, 255, 255);">RBO is slowly being deprecated. For CBO to be used, all the tables referenced by the query must be analyzed. To analyze a table, a DBA can launch code from the DBMS_STATS package.</p><p style="margin: 0.5em 0px; color: rgb(37, 37, 37); font-family: sans-serif; font-size: 14px; font-style: normal; font-variant: normal; font-weight: normal; letter-spacing: normal; orphans: auto; text-align: start; text-indent: 0px; text-transform: none; white-space: normal; widows: 1; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(255, 255, 255);">Other tools for query optimization include:</p><ol style="margin: 0.3em 0px 0px 3.2em; padding: 0px; list-style-image: none; color: rgb(37, 37, 37); font-family: sans-serif; font-size: 14px; font-style: normal; font-variant: normal; font-weight: normal; letter-spacing: normal; orphans: auto; text-align: start; text-indent: 0px; text-transform: none; white-space: normal; widows: 1; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(255, 255, 255);"><li style="margin-bottom: 0.1em;">SQL Trace</li><li style="margin-bottom: 0.1em;">Oracle Trace</li><li style="margin-bottom: 0.1em;">TKPROF</li></ol></div><div><br/></div><div>&lt;book&gt;</div><div><br/></div><div align="left"><font size="2"><span style="font-size:10pt">The integrated Query Editor provides a simple graphical user interface for running</span></font></div><div align="left"><font size="1"><span style="font-size:9pt">SQL</span></font> <font size="2"><span style="font-size:10pt">queries and viewing the results. The Query Editor also provides a</span></font></div><div align="left"><font size="2"><span style="font-size:10pt">graphical representation of</span> <span style="font-size:10pt"><b>showplan</b></span><span style="font-size:10pt">, the steps chosen by the optimizer for</span></font></div><div align="left"><font size="2"><span style="font-size:10pt">query execution. The Query Editor is integrated with Management Studio’s Object</span></font></div><div align="left"><font size="2"><span style="font-size:10pt">Explorer, which lets a user drag and drop object or table names into a query</span></font></div><div align="left"><font size="2"><span style="font-size:10pt">window and helps build</span> <span style="font-size:10pt"><b>select, insert, update,</b></span> <span style="font-size:10pt">or</span> <span style="font-size:10pt"><b>delete</b></span> <span style="font-size:10pt">statements for any table.</span></font></div><div align="left"><font size="2"><span style="font-size:10pt">A database administrator or developer can use Query Editor to:</span></font></div><div align="left"><font color="#00FFFF"><span style="font-size:12pt">•</span></font> <font size="2"><span style="font-size:10pt"><b>Analyze queries:</b></span> <span style="font-size:10pt">Query Editor can show a graphical or textual execution</span></font></div><div align="left"><font size="2"><span style="font-size:10pt">plan for any query, as well as displaying statistics regarding the time and</span></font></div><div align="left"><font size="2"><span style="font-size:10pt">resources required to execute any query.</span></font></div><div align="left"><font color="#00FFFF"><span style="font-size:12pt">•</span></font> <font size="2"><span style="font-size:10pt"><b>Format</b></span></font> <font size="1"><span style="font-size:9pt"><b>SQL</b></span></font> <font size="2"><span style="font-size:10pt"><b>queries:</b></span> <span style="font-size:10pt">Including indenting and color syntax coding.</span></font></div><div align="left"><br/></div><div align="left"><img src="31.- Explain the query execution_files/Image [1].png" type="image/png" style="height:auto;" width="365"/></div><div align="left"><br/></div><div align="left"><div align="left"><font color="#00FFFF"><span style="font-size:12pt">•</span></font> <font size="2"><span style="font-size:10pt"><b>Use templates for stored procedures, functions, and basic</b></span></font> <font size="1"><span style="font-size:9pt"><b>SQL</b></span></font> <font size="2"><span style="font-size:10pt"><b>statements:</b></span></font></div><div align="left"><font size="2"><span style="font-size:10pt">The Management Studio comes with dozens of predefined templates for</span></font></div></div><div align="left"><font size="2"><span style="font-size:10pt">building</span></font> <font size="1"><span style="font-size:9pt">DDL</span></font> <font size="2"><span style="font-size:10pt">commands, or users can define their own<span style="font-family: &apos;Times New Roman&apos;;">.</span></span></font></div><div align="left"><br/></div><div align="left"><br/></div></div></div></span>
</div></body></html> 