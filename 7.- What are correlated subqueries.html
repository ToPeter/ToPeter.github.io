<html>
<head>
  <title>7.- What are correlated subqueries ?</title>
  <basefont face="Tahoma" size="2" />
  <meta http-equiv="Content-Type" content="text/html;charset=utf-8" />
  <meta name="exporter-version" content="Evernote Windows/301769 (en-US); Windows/10.0.14342 (Win64);"/>
  <style>
    body, td {
      font-family: Tahoma;
      font-size: 10pt;
    }
  </style>
</head>
<body>
<a name="854"/>
<h1>7.- What are correlated subqueries ?</h1>

<div>
<span><div><span style="background-color: rgb(255, 255, 255);"><span style="color: rgb(37, 37, 37);">7.- What are correlated subqueries ?</span></span></div><div><b><span style="font-family: sans-serif;"><span style="background-color: rgb(255, 255, 255);"><span style="color: rgb(37, 37, 37);"><br/></span></span></span></b></div><div><b style="color: rgb(37, 37, 37); font-family: sans-serif; font-size: 14px; font-style: normal; font-variant: normal; letter-spacing: normal; orphans: auto; text-align: start; text-indent: 0px; text-transform: none; white-space: normal; widows: 1; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(255, 255, 255);">Correlated subquery</b><span style="color: rgb(37, 37, 37); font-family: sans-serif; font-size: 14px; font-style: normal; font-variant: normal; font-weight: normal; letter-spacing: normal; orphans: auto; text-align: start; text-indent: 0px; text-transform: none; white-space: normal; widows: 1; word-spacing: 0px; -webkit-text-stroke-width: 0px; display: inline !important; float: none; background-color: rgb(255, 255, 255);"> </span><span style="color: rgb(37, 37, 37); font-family: sans-serif; font-size: 14px; font-style: normal; font-variant: normal; font-weight: normal; letter-spacing: normal; orphans: auto; text-align: start; text-indent: 0px; text-transform: none; white-space: normal; widows: 1; word-spacing: 0px; -webkit-text-stroke-width: 0px; display: inline !important; float: none; background-color: rgb(255, 255, 255);">is a subquery (a query nested inside another query) that uses values from the outer query. Because the subquery is evaluated once for each row processed by the outer query, it can be inefficient.</span></div><div><span style="font-family: sans-serif;"><span style="background-color: rgb(255, 255, 255);"><span style="color: rgb(37, 37, 37);"><br/></span></span></span></div><div><span style="color: rgb(37, 37, 37); font-family: sans-serif; font-size: 14px; font-style: normal; font-variant: normal; font-weight: normal; letter-spacing: normal; orphans: auto; text-align: start; text-indent: 0px; text-transform: none; white-space: normal; widows: 1; word-spacing: 0px; -webkit-text-stroke-width: 0px; display: inline !important; float: none; background-color: rgb(255, 255, 255);">Here is an example for a typical correlated subquery. In this example we are finding the list of all employees whose salary is above average for their departments.</span></div><div><span style="font-family: sans-serif;"><span style="background-color: rgb(255, 255, 255);"><span style="color: rgb(37, 37, 37);"><br/></span></span></span></div><div><img src="7.- What are correlated subqueries_files/Image.png" type="image/png" style="height: auto;"/></div><div><br/></div><div><span style="color: rgb(37, 37, 37); font-family: sans-serif; font-size: 14px; font-style: normal; font-variant: normal; font-weight: normal; letter-spacing: normal; orphans: auto; text-align: start; text-indent: 0px; text-transform: none; white-space: normal; widows: 1; word-spacing: 0px; -webkit-text-stroke-width: 0px; display: inline !important; float: none; background-color: rgb(255, 255, 255);">In the above query the outer query is</span></div><div><span style="font-family: sans-serif;"><span style="background-color: rgb(255, 255, 255);"><span style="color: rgb(37, 37, 37);"><br/></span></span></span></div><div><img src="7.- What are correlated subqueries_files/Image [1].png" type="image/png" style="height: auto;"/></div><div><br/></div><div><span style="color: rgb(37, 37, 37); font-family: sans-serif; font-size: 14px; font-style: normal; font-variant: normal; font-weight: normal; letter-spacing: normal; orphans: auto; text-align: start; text-indent: 0px; text-transform: none; white-space: normal; widows: 1; word-spacing: 0px; -webkit-text-stroke-width: 0px; display: inline !important; float: none; background-color: rgb(255, 255, 255);">and the inner query (the correlated subquery) is</span></div><div><span style="font-family: sans-serif;"><span style="background-color: rgb(255, 255, 255);"><span style="color: rgb(37, 37, 37);"><br/></span></span></span></div><div><img src="7.- What are correlated subqueries_files/Image [2].png" type="image/png" style="height: auto;"/></div><div><br/></div><div><span style="color: rgb(37, 37, 37); font-family: sans-serif; font-size: 14px; font-style: normal; font-variant: normal; font-weight: normal; letter-spacing: normal; orphans: auto; text-align: start; text-indent: 0px; text-transform: none; white-space: normal; widows: 1; word-spacing: 0px; -webkit-text-stroke-width: 0px; display: inline !important; float: none; background-color: rgb(255, 255, 255);">In the above nested query the inner query has to be re-executed for each employee. (A sufficiently smart implementation may cache the inner query's result on a department-by-department basis, but even in the best case the inner query must be executed once per department.)</span></div><div><span style="font-family: sans-serif;"><span style="background-color: rgb(255, 255, 255);"><span style="color: rgb(37, 37, 37);"><br/></span></span></span></div><div><span style="color: rgb(37, 37, 37); font-family: sans-serif; font-size: 14px; font-style: normal; font-variant: normal; font-weight: normal; letter-spacing: normal; orphans: auto; text-align: start; text-indent: 0px; text-transform: none; white-space: normal; widows: 1; word-spacing: 0px; -webkit-text-stroke-width: 0px; display: inline !important; float: none; background-color: rgb(255, 255, 255);">Correlated subqueries may appear elsewhere besides the </span><a href="https://en.wikipedia.org/wiki/Where_(SQL)" style="text-decoration: none; color: rgb(11, 0, 128); font-family: sans-serif; font-size: 14px; font-style: normal; font-variant: normal; font-weight: normal; letter-spacing: normal; orphans: auto; text-align: start; text-indent: 0px; text-transform: none; white-space: normal; widows: 1; word-spacing: 0px; -webkit-text-stroke-width: 0px; background: none rgb(255, 255, 255);" title="Where (SQL)">WHERE clause</a><span style="color: rgb(37, 37, 37); font-family: sans-serif; font-size: 14px; font-style: normal; font-variant: normal; font-weight: normal; letter-spacing: normal; orphans: auto; text-align: start; text-indent: 0px; text-transform: none; white-space: normal; widows: 1; word-spacing: 0px; -webkit-text-stroke-width: 0px; display: inline !important; float: none; background-color: rgb(255, 255, 255);">; for example, this query uses a correlated subquery in the </span><a href="https://en.wikipedia.org/wiki/Select_(SQL)" style="text-decoration: none; color: rgb(11, 0, 128); font-family: sans-serif; font-size: 14px; font-style: normal; font-variant: normal; font-weight: normal; letter-spacing: normal; orphans: auto; text-align: start; text-indent: 0px; text-transform: none; white-space: normal; widows: 1; word-spacing: 0px; -webkit-text-stroke-width: 0px; background: none rgb(255, 255, 255);" title="Select (SQL)">SELECT clause</a><span style="color: rgb(37, 37, 37); font-family: sans-serif; font-size: 14px; font-style: normal; font-variant: normal; font-weight: normal; letter-spacing: normal; orphans: auto; text-align: start; text-indent: 0px; text-transform: none; white-space: normal; widows: 1; word-spacing: 0px; -webkit-text-stroke-width: 0px; display: inline !important; float: none; background-color: rgb(255, 255, 255);"> to print the entire list of employees alongside the average salary for each employee's department. Again, because the subquery is correlated with a column of the outer query, it must be re-executed for each row of the result.</span></div><div><span style="font-family: sans-serif;"><span style="background-color: rgb(255, 255, 255);"><span style="color: rgb(37, 37, 37);"><br/></span></span></span></div><div><img src="7.- What are correlated subqueries_files/Image [3].png" type="image/png" style="height: auto;"/></div><div><br/></div><div><u><span style="font-family: &apos;Linux Libertine&apos;, Georgia, Times, serif;"><span style="font-size: 20px;">Optimizing correlated subqueries</span></span></u></div><div><u><span style="font-size: 20px;"><span style="font-family: &apos;Linux Libertine&apos;, Georgia, Times, serif;"><br/></span></span></u></div><div><span style="color: rgb(37, 37, 37); font-family: sans-serif; font-size: 14px; font-style: normal; font-variant: normal; font-weight: normal; letter-spacing: normal; orphans: auto; text-align: start; text-indent: 0px; text-transform: none; white-space: normal; widows: 1; word-spacing: 0px; -webkit-text-stroke-width: 0px; display: inline !important; float: none; background-color: rgb(255, 255, 255);">The effect of correlated subqueries can in some cases be obtained using </span><a href="https://en.wikipedia.org/wiki/Join_(SQL)" style="text-decoration: none; color: rgb(11, 0, 128); font-family: sans-serif; font-size: 14px; font-style: normal; font-variant: normal; font-weight: normal; letter-spacing: normal; orphans: auto; text-align: start; text-indent: 0px; text-transform: none; white-space: normal; widows: 1; word-spacing: 0px; -webkit-text-stroke-width: 0px; background: none rgb(255, 255, 255);" title="Join (SQL)">joins</a><span style="color: rgb(37, 37, 37); font-family: sans-serif; font-size: 14px; font-style: normal; font-variant: normal; font-weight: normal; letter-spacing: normal; orphans: auto; text-align: start; text-indent: 0px; text-transform: none; white-space: normal; widows: 1; word-spacing: 0px; -webkit-text-stroke-width: 0px; display: inline !important; float: none; background-color: rgb(255, 255, 255);">. For example, the queries above (which use inefficient correlated subqueries) may be rewritten as follows.</span></div><div><span style="font-family: sans-serif;"><span style="background-color: rgb(255, 255, 255);"><span style="color: rgb(37, 37, 37);"><br/></span></span></span></div><div><img src="7.- What are correlated subqueries_files/Image [4].png" type="image/png" style="height: auto;"/></div><div><span style="font-size: 20px;"><span style="font-family: &apos;Linux Libertine&apos;, Georgia, Times, serif;"><br/></span></span></div><div><span style="color: rgb(37, 37, 37); font-family: sans-serif; font-size: 14px; font-style: normal; font-variant: normal; font-weight: normal; letter-spacing: normal; orphans: auto; text-align: start; text-indent: 0px; text-transform: none; white-space: normal; widows: 1; word-spacing: 0px; -webkit-text-stroke-width: 0px; display: inline !important; float: none; background-color: rgb(255, 255, 255);">If the inner query used in multiple queries, the inner query can be stored as a view, and then join the view:</span></div><div><span style="font-family: sans-serif;"><span style="background-color: rgb(255, 255, 255);"><span style="color: rgb(37, 37, 37);"><br/></span></span></span></div><div><img src="7.- What are correlated subqueries_files/Image [5].png" type="image/png" style="height: auto;"/></div><div><span style="font-size: 20px;"><span style="font-family: &apos;Linux Libertine&apos;, Georgia, Times, serif;"><br/></span></span></div><div><span style="font-size: 20px;"><span style="font-family: &apos;Linux Libertine&apos;, Georgia, Times, serif;"><br/></span></span></div><div><span style="font-size: 20px;"><span style="font-family: &apos;Linux Libertine&apos;, Georgia, Times, serif;"><br/></span></span></div><div><span style="font-size: 20px;"><span style="font-family: &apos;Linux Libertine&apos;, Georgia, Times, serif;"><br/></span></span></div><div><span style="font-size: 20px;"><span style="font-family: &apos;Linux Libertine&apos;, Georgia, Times, serif;"><br/></span></span></div><div><span style="font-size: 20px;"><span style="font-family: &apos;Linux Libertine&apos;, Georgia, Times, serif;"><br/></span></span></div><div><span style="font-size: 20px;"><span style="font-family: &apos;Linux Libertine&apos;, Georgia, Times, serif;"><br/></span></span></div><div><span style="font-size: 20px;"><span style="font-family: &apos;Linux Libertine&apos;, Georgia, Times, serif;"><br/></span></span></div></span>
</div></body></html> 